# 网络架构模型

## 协议分层

##### 计算机网络使用了分层结构，但是不同地方关于划分的标准并不是完全一致
##### 主流的模型分别***OSI七层模型***和***TCP/IP四(五)层模型***，两者的差异就在于会话层和表示层的缺失上

##  OSI七层模型

| OSI层 | 功能 | 相关协议  |
| :------| ------: | :------: |
| 应用层 | 文件传输，电子邮件，文件服务，虚拟终端 | HTTP，FTP，DNS，Telnet等 |
| 表示层 | 数据格式化，代码转换，数据加密 | * |
| 会话层 | 解除或建立与别的接点的联系 | * |
| 传输层 | 提供端对端的接口 | TCP，UDP |
| 网络层 | 为数据包选择路由 | IP等 |
| 数据链路层  | 传输有地址的帧以及错误检测功能 | SLIP，CSLIP等 |
| 物理层 | 以二进制数据形式在物理媒体上传输数据 | ISO2110，IEEE802等 |		

### 基本概念

	OSI是Open System Interconnect的缩写，意为开放式系统互联
	
	OSI七层参考模型的各个层次的划分遵循下列原则：
		1、同一层中的各网络节点都有相同的层次结构，具有同样的功能
		2、同一节点内相邻层之间通过接口（可以是逻辑接口）进行通信
		3、七层结构中的每一层使用下一层提供的服务，并且向其上层提供服务
		4、不同节点的同等层按照协议实现对等层之间的通信
		
### 各层功能(自上而下)

	应用层：
		为操作系统或网络应用程序提供访问网络服务的接口
		
	表示层：
		主要解决用户信息的语法表示问题
		它将要交换的数据从适合于某一用户的抽象语法，转换为适合于OSI系统内部使用的传送语法，即提供格式化的表示和转换数据服务
		数据的压缩和解压缩，加密和解密等工作都由表示层负责
		
	会话层：
		在会话层及以上的高层次中，数据传送的单位不再另外命名，而是统称为报文
		会话层不参与具体的传输，它提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制
		如服务器验证用户登录便是由会话层完成的
		
	传输层：
		传输层的数据单元叫做数据包，但是具体到TCP等协议时又有特殊的叫法，TCP的数据单元称为“段”，UDP协议的数据单元称为“数据报”
		传输层负责获取全部信息，因此，它必须跟踪数据单元碎片、乱序到达的数据包和其它在传输过程中可能发生的危险
		传输层提供端到端（最终用户到最终用户）的透明的、可靠的数据传输服务
		这里的"透明的传输"是指在通信过程中传输层对上层屏蔽了通信传输系统的具体细节
		传输层协议的代表包括：TCP、UDP等
		
	网络层:
		在计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网
		网络层的任务就是选择合适的网间路由和交换结点，确保数据及时传送
		网络层将数据链路层提供的帧组成数据包，包中封装有网络层包头，其中含有逻辑地址信息(源站点和目的站点地址的网络地址)
		IP协议是网络层协议的一部分，此外还有一些路由协议和地址解析协议
		有关路由的一切事情都在网络层处理，地址解析和路由是网络层的重要目的
		网络层还可以实现拥塞控制、网际互连等功能，在网络层，数据的单位称为数据包
		
	数据链路层：
		数据链路层是在物理层提供比特流服务的基础上，建立相邻结点之间的数据链路，通过差错控制提供数据帧在信道上无差错的传输，并进行各电路上的动作系列
		数据链路层在不可靠的物理介质上提供可靠的传输
		数据链路层的作用包括：物理地址寻址、数据的成帧、流量控制、数据的检错、重发等
		在数据链路层，数据的单位称为帧
		
	物理层：
		物理层规定了通信设备的机械的、电气的、功能的和过程的特性，用以建立、维护和拆除物理链路连接
		具体地讲：
			机械特性规定了网络连接时所需接插件的规格尺寸、引脚数量和排列情况等
			电气特性规定了在物理连接上传输bit流时线路上信号电平的大小、阻抗匹配、传输速率距离限制等
			功能特性是指对各个信号先分配确切的信号含义，即定义了DTE和DCE之间各个线路的功能
			规程特性定义了利用信号线进行bit流传输的一组操作规程，即规定了在物理连接的建立、维护、交换信息时，DTE和DCE双方在各电路上的动作系列
			
			
### 注：

	DCE(数据通信设备或者数据电路终端设备): 
		该设备和其与通信网络的连接构成了网络终端的用户网络接口
		它提供了到网络的一条物理连接、转发业务量，并且提供了一个用于同步DCE设备和DTE设备之间数据传输的时钟信号
		调制解调器和接口卡都是DCE设备的例子
 
	DTE(数据终端设备):
		指的是位于用户网络接口用户端的设备，它能够作为信源、信宿或同时为二者
		数据终端设备通过数据通信设备（例如，调制解调器）连接到一个数据网络上，并且通常使用数据通信设备产生的时钟信号
		数据终端设备包括计算机、协议翻译器以及多路分解器等设备
			
	


##  TCP/IP四(五)层模型

四层的模型中数据链路层和物理层在同一层	

| TCP/IP层 | 网络设备 |
| ------- | ------- |
| 应用层 | * |
| 传输层 | 四层交换机，也有一些工作在传输层的路由器 |
| 网络层 | 路由器、三层交换机 |
| 数据链路层 | 以太网交换机，网卡(网卡其实是一半工作在数据链路层，一半工作在物理层) |
| 物理层 | 中继器、集线器、双绞线 |

### 各层功能(自上而下)

	应用层：
		负责应用程序之间的沟通
		网络编程主要针对的就是应用层
		
	传输层：
		负责两台主机之间的数据传输
		
	网络层：
		负责地址管理和路由选择
		
	数据链路层：
		负责设备之间的数据帧的传输和识别
		例如网卡设备的驱动，帧同步，冲突检测，数据差错校验等工作
		
	物理层：
		负责光电信号传递方式
		
	应用层的封装在应用程序中完成
	传输层和网络层的封装在操作系统完成
	数据链路层和物理层的封装在设备驱动程序与网络接口中完成
				
### 一般来说：

	对于一台主机，它的操作系统内核实现了传输层到物理层的内容
	对于一台路由器，它实现了从网络层到物理层
	对于一台交换机，它实现了由数据链路层到物理层
	对于集线器，他只实现了物理层
	
## 数据包封装和分用

	数据在网络中的传输，是不能直接把数据丢到网络上去传输的
	在不同的协议中对数据包有不同的称呼，在传输层中叫做“段”，在网络层中叫做“数据报”，在数据链路层叫做“帧”
	
	应用层数据通过协议栈发送到网络上时，每层协议都要加上一个数据首部，称为封装
	首部信息包括上层协议，pyload等信息
	
	数据封装成帧后发到传输介质上，到达目的主机后每层协议再剥掉相应的首部，根据首部中的“上层协议”字段将数据交给对应的上层协议处理
	
	一般的数据包封装过程如下：
	
		1. 用户数据				  	经过逻辑封装 ————> Appl首部 + 用户数据
		2. (Appl首部)用户数据				经过TCP封装  ————> TCP首部 + 应用数据(应用数据即：Appl首部 + 用户数据)
		3. TCP首部 + 应用数据				经过IP封装  ————> IP首部 + TCP首部 + 应用数据
		4. IP首部 + TCP首部 + 应用数据		        经过帧封装  ————> 以太网首部 + IP首部 + TCP首部 + 应用数据
		
	数据包分用就是封装的逆过程

### 应用层的封装

	设置Appl首部:
		“用户数据”就是实际要发送的数据，比如打算发送一个字符串:”zexiang”，Appl首部就是自己设计的一个包结构，比如在Appl首部里面设计一个4个字节的int数据，用来表示后面内容的长度：那么当你发送”zexiang”的时候，Appl首部里面就是这个字符串的长度6，接收端先接受4个字节，得到长度，再按照长度接受内容
		
	在用户数据末端加上“结束标志”：
		http协议的应用层封装原理就是，用**\r\n\r\n**表示一段内容结束（当然也可以选择其他的特定字符作为结束标志）
		当你发送”zexiang”的时候，其实就是发送”zexiang\r\n\r\n”，接收端接受数据，遇到\r\n\r\n结束接受一段数据